{"version":3,"sources":["../../../src/utils/numbers.ts","../../../src/components/table/summary.tsx"],"names":[],"mappings":"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","file":"summary.js","sourcesContent":["import Bignumber from 'bignumber.js'\n\n/**千分位 */\nexport function thousands(num: number | string) {\n  if (!isNumber(num)) return num\n  const arr = String(num).split('.')\n  const intPart = arr[0].replace(/(\\d)(?=(\\d{3})+$)/g, '$1,')\n  return arr[1] ? `${intPart}.${arr[1]}` : intPart\n}\n\n/**小数保留n位 */\nexport function toFixed(num: number | string, n = 2) {\n  return new Bignumber(num).toFixed(n)\n}\n\n/**四舍五入 */\nexport function round(num: number | string, n = 2) {\n  return new Bignumber(num).decimalPlaces(n, Bignumber.ROUND_HALF_UP).toNumber()\n}\n\n/**小数不足n位补零 */\nexport function zerofill(num: number | string, n = 2) {\n  const [intPart, decPart = ''] = String(num).split('.')\n  if (decPart.length >= n) return num\n  const filledDec = decPart.padEnd(n, '0').slice(0, n)\n  return `${intPart}.${filledDec}`\n}\n\n/**数字转换为百分比模式 */\nexport function toPercent(num: number | string) {\n  return multiply(num, 100) + '%'\n}\n\n/**判断是否是数字 */\nexport function isNumber(num: any): num is number {\n  const n = new Bignumber(num)\n  return n.isFinite() && !n.isNaN()\n}\n\n/**乘法 */\nexport function multiply(a: number | string, b: number | string) {\n  return new Bignumber(a).times(b).toNumber()\n}\n\n/**除法 */\nexport function divide(a: number | string, b: number | string) {\n  return new Bignumber(a).div(b).toNumber()\n}\n\n/**加法 */\nexport function add(a: number | string, b: number | string) {\n  return new Bignumber(a).plus(b).toNumber()\n}\n\n/**减法 */\nexport function subtract(a: number | string, b: number | string) {\n  return new Bignumber(a).minus(b).toNumber()\n}\n\n/**取余 */\nexport function mod(a: number | string, b: number | string) {\n  return new Bignumber(a).mod(b).toNumber()\n}\n","import { useMemo } from 'react'\nimport { Table } from 'antd'\nimport { isNumber, round, zerofill, thousands, multiply } from '@/utils'\nimport type { SxProps } from '@quick/cssinjs'\nimport type {\n  ColumnProps,\n  ColumnType,\n  ColumnGroupType,\n  AnyObject,\n  TableProps,\n  SummaryProps\n} from './types'\n\nconst { Summary } = Table\n\nconst flatten = (arr: ColumnProps<any>[]) => {\n  return arr.reduce((acc, props) => {\n    const { children, ...rest } = props as ColumnGroupType\n    acc.push(rest)\n    if (Array.isArray(children)) acc.push(...flatten(children))\n    return acc\n  }, [] as ColumnType[])\n}\n\nexport const useSummary = <T extends AnyObject = AnyObject>(\n  columns: ColumnProps<T>[],\n  summaryMap?: Record<string, number>,\n  rowSelection?: TableProps<T>['rowSelection']\n) => {\n  return useMemo(() => {\n    const summaryList = flatten(columns)\n    const hasTotal = summaryList.some(item => item.total)\n    return hasTotal\n      ? () => (\n          <Summary fixed>\n            <Summary.Row>\n              {rowSelection && <Summary.Cell index={0} />}\n              <Summary.Cell index={rowSelection ? 1 : 0}>合计</Summary.Cell>\n              {summaryList.slice(1).map((item, index) => {\n                let sx: SxProps = {}\n                let defaultSummary: SummaryProps = { thousand: true }\n                let value: number | string | undefined =\n                  summaryMap?.[item.totalField ?? (item.dataIndex as string)]\n                if (typeof item.total === 'object') {\n                  defaultSummary = { ...defaultSummary, ...item.total }\n                }\n                let {\n                  precision,\n                  zerofill: fill,\n                  percent,\n                  thousand: thousandNum,\n                  formatter,\n                  className,\n                  status\n                } = defaultSummary\n                if (typeof formatter === 'function') {\n                  value = formatter(value)\n                }\n                if (isNumber(value)) {\n                  // 处理百分比\n                  if (percent) value = multiply(Number(value), 100)\n                  // 处理四舍五入\n                  if (precision === true) precision = 2\n                  if (isNumber(precision)) value = round(value, precision)\n                  // 小数补零\n                  if (fill === true) fill = precision || 0\n                  if (isNumber(fill)) value = zerofill(value, fill)\n                  // 处理千分位\n                  if (thousandNum) value = value ? thousands(value) : value\n                  // 添加%\n                  if (percent) value = `${value}%`\n                }\n                className = typeof className === 'function' ? className(value) : className\n                if (status) {\n                  const statusColor = typeof status === 'function' ? status(value) : status\n                  sx.color = statusColor === 'default' ? null : statusColor\n                }\n                return (\n                  <Summary.Cell\n                    className={className ?? undefined}\n                    key={index + 1}\n                    index={index + 1}\n                    sx={sx}\n                  >\n                    {value ?? null}\n                  </Summary.Cell>\n                )\n              })}\n            </Summary.Row>\n          </Summary>\n        )\n      : undefined\n  }, [columns, summaryMap])\n}\n"]}