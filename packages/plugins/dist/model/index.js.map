{"version":3,"sources":["../../src/model/index.ts"],"sourcesContent":["import { resolve, basename, extname, dirname } from 'path'\nimport { globSync } from 'glob'\nimport { definePlugin } from '@quick/core'\n\nconst include = ['models/**/*.{ts,js}']\n\nconst getModels = (srcDir = 'src') => {\n  srcDir = resolve(process.cwd(), srcDir)\n  const files = globSync(include, { cwd: srcDir })\n  return files.map(v => {\n    const filename = basename(v, extname(v))\n    return { name: filename, path: resolve(srcDir, dirname(v), filename) }\n  })\n}\n\nexport default definePlugin({\n  setup: ({ context, addWatch, addFileTemplate, addExport }) => {\n    addExport({\n      specifier: ['useModel'],\n      source: resolve(import.meta.dirname, 'context')\n    })\n    addFileTemplate({\n      sourcePath: resolve(import.meta.dirname, 'model.ts.hbs'),\n      outPath: resolve(import.meta.dirname, 'model.ts'),\n      data: { models: getModels(context.srcDir) }\n    })\n    addWatch((event, path) => {\n      const regex = new RegExp(\n        `^${resolve(process.cwd(), context.srcDir)}/models/.*\\.(ts|js)$`\n      )\n      if (['add', 'unlink'].includes(event) && regex.test(path)) {\n        addFileTemplate({\n          sourcePath: resolve(import.meta.dirname, 'model.ts.hbs'),\n          outPath: resolve(import.meta.dirname, 'model.ts'),\n          data: {\n            models: getModels(context.srcDir)\n          }\n        })\n      }\n    })\n  },\n  runtime: resolve(import.meta.dirname, 'runtime')\n})\n"],"mappings":";AAAA,SAAS,SAAS,UAAU,SAAS,eAAe;AACpD,SAAS,gBAAgB;AACzB,SAAS,oBAAoB;AAE7B,IAAM,UAAU,CAAC,qBAAqB;AAEtC,IAAM,YAAY,CAAC,SAAS,UAAU;AACpC,WAAS,QAAQ,QAAQ,IAAI,GAAG,MAAM;AACtC,QAAM,QAAQ,SAAS,SAAS,EAAE,KAAK,OAAO,CAAC;AAC/C,SAAO,MAAM,IAAI,OAAK;AACpB,UAAM,WAAW,SAAS,GAAG,QAAQ,CAAC,CAAC;AACvC,WAAO,EAAE,MAAM,UAAU,MAAM,QAAQ,QAAQ,QAAQ,CAAC,GAAG,QAAQ,EAAE;AAAA,EACvE,CAAC;AACH;AAEA,IAAO,gBAAQ,aAAa;AAAA,EAC1B,OAAO,CAAC,EAAE,SAAS,UAAU,iBAAiB,UAAU,MAAM;AAC5D,cAAU;AAAA,MACR,WAAW,CAAC,UAAU;AAAA,MACtB,QAAQ,QAAQ,YAAY,SAAS,SAAS;AAAA,IAChD,CAAC;AACD,oBAAgB;AAAA,MACd,YAAY,QAAQ,YAAY,SAAS,cAAc;AAAA,MACvD,SAAS,QAAQ,YAAY,SAAS,UAAU;AAAA,MAChD,MAAM,EAAE,QAAQ,UAAU,QAAQ,MAAM,EAAE;AAAA,IAC5C,CAAC;AACD,aAAS,CAAC,OAAO,SAAS;AACxB,YAAM,QAAQ,IAAI;AAAA,QAChB,IAAI,QAAQ,QAAQ,IAAI,GAAG,QAAQ,MAAM,CAAC;AAAA,MAC5C;AACA,UAAI,CAAC,OAAO,QAAQ,EAAE,SAAS,KAAK,KAAK,MAAM,KAAK,IAAI,GAAG;AACzD,wBAAgB;AAAA,UACd,YAAY,QAAQ,YAAY,SAAS,cAAc;AAAA,UACvD,SAAS,QAAQ,YAAY,SAAS,UAAU;AAAA,UAChD,MAAM;AAAA,YACJ,QAAQ,UAAU,QAAQ,MAAM;AAAA,UAClC;AAAA,QACF,CAAC;AAAA,MACH;AAAA,IACF,CAAC;AAAA,EACH;AAAA,EACA,SAAS,QAAQ,YAAY,SAAS,SAAS;AACjD,CAAC;","names":[]}