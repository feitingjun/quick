{"version":3,"sources":["../../src/keepAlive/fixContext.ts"],"sourcesContent":["import React, { Context } from 'react'\nimport jsxRuntime from 'react/jsx-runtime'\nimport jsxDevRuntime from 'react/jsx-dev-runtime'\nimport { ScopeContext, KeepAliveContext } from './context'\n\n/**储存所有的context */\nconst fixedContext:Context<any>[] = []\n/**\n * 缓存某个keepAlive第一次加载时获取到的fixedContext\n * 因为fixedContext会随着加载的页面增多而增多，如果不缓存，\n * 每次context的数量变更会导致keepAlive内的Bridge层级增加，从而导致缓存的页面卸载之后重新加载，\n * 从而导致缓存失效\n*/\nconst contextCaches = new Map<string, Context<any>[]>()\n\n/**更加name获取fixedContext */\nexport function getFixedContext(name:string){\n  if(!contextCaches.has(name)){\n    contextCaches.set(name, [...fixedContext])\n  }\n  return contextCaches.get(name)\n}\n\nfunction repair<T extends any>(mods:T, names:(keyof T)[]){\n  names.forEach(name => {\n    const oldFn = mods[name]\n    if(typeof oldFn !== 'function') return\n    mods[name] = function(type:any, ...args:any[]){\n      if(typeof type === 'object' && type['$$typeof'] === Symbol.for('react.context')){\n        if(![ScopeContext, KeepAliveContext].includes(type) && !fixedContext.includes(type)) {\n          fixedContext.push(type)\n        }\n      }\n      return oldFn(type, ...args)\n    } as T[keyof T]\n  })\n}\n\nrepair(React, ['createElement'])\nrepair(jsxRuntime, ['jsx', 'jsxs'])\nrepair(jsxDevRuntime, ['jsxDEV'])"],"mappings":";;;;;;AAAA,OAAO,WAAwB;AAC/B,OAAO,gBAAgB;AACvB,OAAO,mBAAmB;AAI1B,IAAM,eAA8B,CAAC;AAOrC,IAAM,gBAAgB,oBAAI,IAA4B;AAG/C,SAAS,gBAAgB,MAAY;AAC1C,MAAG,CAAC,cAAc,IAAI,IAAI,GAAE;AAC1B,kBAAc,IAAI,MAAM,CAAC,GAAG,YAAY,CAAC;AAAA,EAC3C;AACA,SAAO,cAAc,IAAI,IAAI;AAC/B;AAEA,SAAS,OAAsB,MAAQ,OAAkB;AACvD,QAAM,QAAQ,UAAQ;AACpB,UAAM,QAAQ,KAAK,IAAI;AACvB,QAAG,OAAO,UAAU,WAAY;AAChC,SAAK,IAAI,IAAI,SAAS,SAAa,MAAW;AAC5C,UAAG,OAAO,SAAS,YAAY,KAAK,UAAU,MAAM,OAAO,IAAI,eAAe,GAAE;AAC9E,YAAG,CAAC,CAAC,cAAc,gBAAgB,EAAE,SAAS,IAAI,KAAK,CAAC,aAAa,SAAS,IAAI,GAAG;AACnF,uBAAa,KAAK,IAAI;AAAA,QACxB;AAAA,MACF;AACA,aAAO,MAAM,MAAM,GAAG,IAAI;AAAA,IAC5B;AAAA,EACF,CAAC;AACH;AAEA,OAAO,OAAO,CAAC,eAAe,CAAC;AAC/B,OAAO,YAAY,CAAC,OAAO,MAAM,CAAC;AAClC,OAAO,eAAe,CAAC,QAAQ,CAAC;","names":[]}